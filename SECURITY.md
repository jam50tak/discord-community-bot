# セキュリティガイド

## 🔒 APIキー管理のセキュリティ

### ✅ 推奨方法：環境変数での設定

#### Railway ダッシュボードでの設定
1. Railway プロジェクトダッシュボードにアクセス
2. 「Variables」タブを選択
3. 以下の環境変数を個別に追加：

```
OPENAI_API_KEY = sk-...
ANTHROPIC_API_KEY = sk-ant-...
GOOGLE_API_KEY = ...
```

#### セキュリティ利点
- ✅ **暗号化保存**: Railway側で暗号化されて保存
- ✅ **アクセス制限**: プロジェクトメンバーのみアクセス可能
- ✅ **ログ非表示**: ビルドログに表示されない
- ✅ **バージョン管理外**: GitHubリポジトリに含まれない

### ⚠️ 避けるべき方法

#### 1. コードファイルに直接記述
```typescript
// ❌ 絶対にやらない
const apiKey = "sk-1234567890...";
```

#### 2. .envファイルをコミット
```bash
# ❌ .envファイルをGitにコミットしない
git add .env  # 危険
```

#### 3. 公開場所での共有
- ❌ Discord メッセージでの共有
- ❌ 公開チャンネルでの設定
- ❌ スクリーンショットに含める

## 🛡️ セキュリティベストプラクティス

### APIキーの管理

#### 定期的なローテーション
- 📅 **月1回**: APIキーを再生成
- 🔄 **即座に更新**: 漏洩の疑いがある場合

#### アクセス権限の最小化
- 👥 **必要最小限**: Railway プロジェクトアクセス権限
- 🔐 **権限分離**: 開発・本番環境の分離

### ボット権限の管理

#### Discord ボット権限
```
✅ 必要な権限のみ付与:
- Read Message History
- Send Messages
- Use Slash Commands
- View Channels

❌ 不要な権限は付与しない:
- Administrator
- Manage Server
- Manage Roles (設定に応じて)
```

### 監査とモニタリング

#### ログ監視
- 🔍 **異常なアクセス**: 通常と異なる使用パターン
- 📊 **API使用量**: 予期しない大量のAPI呼び出し
- ⚠️ **エラーログ**: 認証関連のエラー

#### セキュリティインシデント対応
1. **即座にAPIキーを無効化**
2. **新しいAPIキーを生成**
3. **環境変数を更新**
4. **ボットを再起動**

## 🔄 デプロイ時のセキュリティ

### 安全なデプロイ手順
1. ✅ 環境変数でAPIキー設定
2. ✅ コードレビューの実施
3. ✅ セキュリティチェック
4. ✅ 段階的デプロイ（可能な場合）

### デプロイ後の確認
```bash
# APIキーの状態確認
/config apikey status

# 期待される表示:
# ✅ Claude (設定済み - 環境変数)
# ✅ ChatGPT (設定済み - 環境変数)
```

## 🚨 インシデント対応

### APIキー漏洩の疑いがある場合

#### 即座に実行
1. **API提供者の管理画面でキーを無効化**
2. **新しいAPIキーを生成**
3. **Railway環境変数を更新**
4. **ボットを再起動**

#### 調査と対策
1. **漏洩経路の特定**
2. **ログの確認**
3. **セキュリティ対策の見直し**
4. **再発防止策の実装**

## 📞 サポート連絡先

セキュリティに関する問題や疑問がある場合：
- GitHub Issues でセキュリティラベル付きで報告
- 機密情報は公開チャンネルを避けて個別連絡

---

**重要**: このドキュメントは定期的に見直し、最新のセキュリティベストプラクティスに従って更新してください。